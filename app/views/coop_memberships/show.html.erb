<div class="container mt-4">
  <% if notice %>
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      <%= notice %>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <% end %>

  <div class="mb-3">
    <%= link_to "â† Back to memberships", coop_memberships_path, class: "text-decoration-none", style: "color: #CCCCCC;" %>
  </div>

  <div class="card">
    <div class="card-header text-white" style="background-color: #002C88;">
      <h2 class="mb-0">Membership Details</h2>
      <small class="text-white-50">Membership #<%= @coop_membership.id %></small>
    </div>
    <div class="card-body">
      <!-- Overview Cards -->
      <div class="row mb-4">
        <div class="col-md-6">
          <div class="card h-100" style="border: 2px solid #F9CB25;">
            <div class="card-header" style="background-color: #F9CB25; color: #031249;">
              <h5 class="mb-0 fw-bold">Cooperative Information</h5>
            </div>
            <div class="card-body">
              <p class="mb-2">
                <strong>Cooperative Name:</strong><br>
                <span class="fs-5 fw-bold" style="color: #002C88;">
                  <%= @coop_membership.cooperative&.name || 'N/A' %>
                </span>
              </p>
              <% if @coop_membership.cooperative %>
                <p class="mb-2">
                  <strong>Location:</strong><br>
                  <span class="text-muted">
                    <%= [
                      @coop_membership.cooperative.barangay&.name,
                      @coop_membership.cooperative.municipal&.name,
                      @coop_membership.cooperative.province&.name,
                      @coop_membership.cooperative.region&.name
                    ].compact.join(', ') %>
                  </span>
                </p>
                <p class="mb-0">
                  <strong>Total Members:</strong>
                  <span class="badge" style="background-color: #F9CB25; color: #031249;">
                    <%= @coop_membership.cooperative.coop_memberships.count %>
                  </span>
                </p>
              <% end %>
              <div class="mt-3">
                <%= link_to "View Cooperative", @coop_membership.cooperative, class: "btn btn-sm", style: "background-color: #002C88; color: #FDFDFD;" if @coop_membership.cooperative %>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card h-100" style="border: 2px solid #002C88;">
            <div class="card-header text-white" style="background-color: #002C88;">
              <h5 class="mb-0">Member Information</h5>
            </div>
            <div class="card-body">
              <p class="mb-2">
                <strong>Full Name:</strong><br>
                <span class="fs-5 fw-bold" style="color: #031249;">
                  <%= @coop_membership.individual&.full_name || 'N/A' %>
                </span>
              </p>
              <% if @coop_membership.individual %>
                <p class="mb-2">
                  <strong>Birth Date:</strong>
                  <%= @coop_membership.individual.birth_date&.strftime("%B %d, %Y") || 'N/A' %>
                  <% if @coop_membership.individual.birth_date %>
                    <small class="text-muted">
                      (<%= ((Date.today - @coop_membership.individual.birth_date) / 365).to_i %> years old)
                    </small>
                  <% end %>
                </p>
                <p class="mb-0">
                  <strong>Gender:</strong>
                  <%= @coop_membership.individual.gender || 'N/A' %>
                </p>
              <% end %>
              <div class="mt-3">
                <%= link_to "View Individual", @coop_membership.individual, class: "btn btn-sm", style: "background-color: #002C88; color: #FDFDFD;" if @coop_membership.individual %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Membership Details -->
      <div class="card mb-4" style="border: 2px solid #031249;">
        <div class="card-header text-white" style="background-color: #031249;">
          <h5 class="mb-0">Membership Details</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-4">
              <div class="p-3 rounded text-center" style="background-color: #F9CB25;">
                <small style="color: #031249;">Membership Date</small>
                <h5 class="mb-0 fw-bold" style="color: #031249;">
                  <%= @coop_membership.membership_date&.strftime("%B %d, %Y") || 'N/A' %>
                </h5>
              </div>
            </div>
            <div class="col-md-4">
              <div class="p-3 rounded text-center" style="background-color: #FDFDFD; border: 1px solid #CCCCCC;">
                <small style="color: #031249;">Member Since</small>
                <h5 class="mb-0 fw-bold" style="color: #002C88;">
                  <% if @coop_membership.membership_date %>
                    <%= ((Date.today - @coop_membership.membership_date) / 365).to_i %> years
                  <% else %>
                    N/A
                  <% end %>
                </h5>
              </div>
            </div>
            <div class="col-md-4">
              <div class="p-3 rounded text-center" style="background-color: #FDFDFD; border: 1px solid #CCCCCC;">
                <small style="color: #031249;">Insurance Contracts</small>
                <h5 class="mb-0 fw-bold" style="color: #002C88;">
                  <%= @coop_membership.insurance_contracts.count %>
                </h5>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Insurance Contracts Section -->
      <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center" style="background-color: #002C88; color: #FDFDFD;">
          <h5 class="mb-0">Insurance Contracts</h5>
          <%= link_to "Add Insurance Contract", new_coop_membership_insurance_contract_path(@coop_membership), class: "btn btn-sm", style: "background-color: #F9CB25; color: #031249;" %>
        </div>
        <div class="card-body">
          <% if @coop_membership.insurance_contracts.empty? %>
            <div class="text-center py-4">
              <p class="text-muted mb-3">No insurance contracts yet</p>
              <%= link_to "Create first contract", new_coop_membership_insurance_contract_path(@coop_membership), class: "btn text-white", style: "background-color: #002C88;" %>
            </div>
          <% else %>
            <div class="table-responsive">
              <table class="table table-hover">
                <thead style="background-color: #FDFDFD; color: #031249;">
                  <tr>
                    <th>ID</th>
                    <th>Agreement Type</th>
                    <th>Age</th>
                    <th>Amount Covered</th>
                    <th>Premium</th>
                    <th>Rate</th>
                    <th>Effectivity</th>
                    <th>Expiry</th>
                    <th class="text-end">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% @coop_membership.insurance_contracts.each do |contract| %>
                    <tr>
                      <td><strong>#<%= contract.id %></strong></td>
                      <td>
                        <span class="badge <%= contract.agreement_type == 'Agreement::Rate' ? 'text-white' : '' %>" style="background-color: <%= contract.agreement_type == 'Agreement::Rate' ? '#002C88' : '#F9CB25' %>; color: <%= contract.agreement_type == 'Agreement::Rate' ? '#FDFDFD' : '#031249' %>;">
                          <%= contract.agreement_type&.split('::')&.last || 'N/A' %>
                        </span>
                      </td>
                      <td><%= contract.age %></td>
                      <td><%= number_to_currency(contract.amount_covered) %></td>
                      <td><%= number_to_currency(contract.premium) %></td>
                      <td><%= number_with_precision(contract.rate, precision: 2) %>%</td>
                      <td><%= contract.effectivity&.strftime("%m/%d/%Y") %></td>
                      <td><%= contract.expiry&.strftime("%m/%d/%Y") %></td>
                      <td class="text-end">
                        <%= link_to "View", [@coop_membership, contract], class: "btn btn-sm", style: "background-color: #002C88; color: #FDFDFD;" %>
                        <%= button_to "Delete", [@coop_membership, contract], method: :delete,
                            data: { confirm: "Are you sure?" },
                            class: "btn btn-sm text-white", style: "background-color: #A80F21;" %>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Metadata -->
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title" style="color: #002C88;">Record Information</h5>
          <div class="row">
            <div class="col-md-4">
              <strong>Membership ID:</strong><br>
              <span class="text-muted">#<%= @coop_membership.id %></span>
            </div>
            <div class="col-md-4">
              <strong>Created At:</strong><br>
              <span class="text-muted"><%= @coop_membership.created_at.strftime("%B %d, %Y at %I:%M %p") %></span>
            </div>
            <div class="col-md-4">
              <strong>Last Updated:</strong><br>
              <span class="text-muted"><%= @coop_membership.updated_at.strftime("%B %d, %Y at %I:%M %p") %></span>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-4 d-flex gap-2">
        <%= link_to "Edit this membership", edit_coop_membership_path(@coop_membership), class: "btn text-white", style: "background-color: #002C88;" %>
        <%= link_to "Back to memberships", coop_memberships_path, class: "btn text-white", style: "background-color: #CCCCCC; color: #031249;" %>
        <%= button_to "Delete this membership", @coop_membership, method: :delete,
            data: { confirm: "Are you sure you want to delete this membership?" },
            class: "btn text-white", style: "background-color: #A80F21;" %>
      </div>
    </div>
  </div>
</div>