<div class="container mt-4">
  <% if notice %>
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      <%= notice %>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <% end %>

  <div class="mb-3">
    <%= link_to "← Back to rates", agreement_rates_path, class: "text-decoration-none", style: "color: #CCCCCC;" %>
  </div>

  <div class="card">
    <div class="card-header text-white" style="background-color: #002C88;">
      <h2 class="mb-0">Rate Details</h2>
      <small class="text-white-50">Rate #<%= @agreement_rate.id %></small>
    </div>
    <div class="card-body">
      <!-- Contract Information -->
      <div class="card mb-4" style="border: 2px solid #F9CB25;">
        <div class="card-header" style="background-color: #F9CB25; color: #031249;">
          <h5 class="mb-0 fw-bold">Agreement Contract</h5>
        </div>
        <div class="card-body">
          <% if @agreement_rate.contract %>
            <p class="mb-2">
              <strong>Contract ID:</strong> #<%= @agreement_rate.contract.id %>
            </p>
            <p class="mb-2">
              <strong>Contractable:</strong> <%= @agreement_rate.contract.contractable_name %>
            </p>
            <p class="mb-0">
              <strong>Insurance Product:</strong> <%= @agreement_rate.contract.insurance_product&.name || 'N/A' %>
            </p>
            <div class="mt-3">
              <%= link_to "View Contract", agreement_contract_path(@agreement_rate.contract), class: "btn btn-sm text-white", style: "background-color: #002C88;" %>
            </div>
          <% else %>
            <p class="text-muted mb-0">No contract associated</p>
          <% end %>
        </div>
      </div>

      <!-- Rate Information -->
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title" style="color: #002C88;">Rate Information</h5>
          <div class="row">
            <div class="col-md-6 mb-3">
              <div class="p-3 rounded text-center" style="background-color: #002C88;">
                <small style="color: #FDFDFD;">Age Range</small>
                <h3 class="mb-0 fw-bold" style="color: #FDFDFD;">
                  <%= @agreement_rate.age_from %> - <%= @agreement_rate.age_to %> years
                </h3>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <div class="p-3 rounded text-center" style="background-color: #F9CB25;">
                <small style="color: #031249;">Rate</small>
                <h3 class="mb-0 fw-bold" style="color: #031249;">
                  <%= number_with_precision(@agreement_rate.rate, precision: 2) %>%
                </h3>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <div class="p-3 rounded text-center" style="background-color: #FDFDFD; border: 1px solid #CCCCCC;">
                <small style="color: #031249;">Minimum Amount</small>
                <h5 class="mb-0 fw-bold" style="color: #002C88;">
                  <%= number_to_currency(@agreement_rate.min_amount, precision: 2) %>
                </h5>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <div class="p-3 rounded text-center" style="background-color: #FDFDFD; border: 1px solid #CCCCCC;">
                <small style="color: #031249;">Maximum Amount</small>
                <h5 class="mb-0 fw-bold" style="color: #002C88;">
                  <%= number_to_currency(@agreement_rate.max_amount, precision: 2) %>
                </h5>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Example Calculation -->
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title" style="color: #002C88;">Example Calculation</h5>
          <div class="alert" style="background-color: #FDFDFD; border: 1px solid #F9CB25; color: #031249;">
            <strong>How it works:</strong> Premium = (Coverage Amount ÷ 1,000) × Rate × Term (in months)
            <br><br>
            <strong>Example:</strong> For a coverage of <%= number_to_currency(@agreement_rate.min_amount) %> over 12 months:
            <br>
            (<%= number_to_currency(@agreement_rate.min_amount) %> ÷ 1,000) × <%= @agreement_rate.rate %>% × 12 months 
            = <%= number_to_currency((@agreement_rate.min_amount / 1000) * @agreement_rate.rate * 12, precision: 2) %>
          </div>
        </div>
      </div>

      <!-- Metadata -->
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title" style="color: #002C88;">Record Information</h5>
          <div class="row">
            <div class="col-md-4">
              <strong>Rate ID:</strong><br>
              <span class="text-muted">#<%= @agreement_rate.id %></span>
            </div>
            <div class="col-md-4">
              <strong>Created At:</strong><br>
              <span class="text-muted"><%= @agreement_rate.created_at.strftime("%B %d, %Y at %I:%M %p") %></span>
            </div>
            <div class="col-md-4">
              <strong>Last Updated:</strong><br>
              <span class="text-muted"><%= @agreement_rate.updated_at.strftime("%B %d, %Y at %I:%M %p") %></span>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-4 d-flex gap-2">
        <%= link_to "Edit this rate", edit_agreement_rate_path(@agreement_rate), class: "btn text-white", style: "background-color: #002C88;" %>
        <%= link_to "Back to rates", agreement_rates_path, class: "btn text-white", style: "background-color: #CCCCCC; color: #031249;" %>
        <%= button_to "Delete this rate", @agreement_rate, method: :delete,
            data: { confirm: "Are you sure you want to delete this rate?" },
            class: "btn text-white", style: "background-color: #A80F21;" %>
      </div>
    </div>
  </div>
</div>  