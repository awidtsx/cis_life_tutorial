<div class="container mt-4">
  <% if notice %>
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      <%= notice %>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <% end %>

  <div class="mb-3">
    <%= link_to "â† Back to individuals", individuals_path, class: "text-decoration-none" %>
  </div>

  <div class="card">
    <div class="card-header bg-primary text-white">
      <h2 class="mb-0">Individual Details</h2>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-8 mb-4">
          <div class="card h-100">
            <div class="card-body">
              <h5 class="card-title text-primary mb-3">Personal Information</h5>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <strong>Last Name:</strong><br>
                  <span class="fs-5"><%= @individual.last_name %></span>
                </div>
                <div class="col-md-6 mb-3">
                  <strong>First Name:</strong><br>
                  <span class="fs-5"><%= @individual.first_name %></span>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <strong>Middle Initial:</strong><br>
                  <%= @individual.mi || 'N/A' %>
                </div>
                <div class="col-md-6 mb-3">
                  <strong>Full Name:</strong><br>
                  <span class="text-primary fw-bold"><%= @individual.full_name %></span>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <strong>Birth Date:</strong><br>
                  <%= @individual.birth_date&.strftime("%B %d, %Y") || 'N/A' %>
                </div>
                <div class="col-md-6 mb-3">
                  <strong>Gender:</strong><br>
                  <%= @individual.gender %>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-4 mb-4">
          <div class="card h-100">
            <div class="card-body">
              <h5 class="card-title text-primary mb-3">Metadata</h5>
              <p class="mb-2">
                <strong>Individual ID:</strong><br>
                <span class="text-muted">#<%= @individual.id %></span>
              </p>
              <p class="mb-2">
                <strong>Created At:</strong><br>
                <span class="text-muted"><%= @individual.created_at.strftime("%B %d, %Y") %></span>
              </p>
              <p class="mb-0">
                <strong>Last Updated:</strong><br>
                <span class="text-muted"><%= @individual.updated_at.strftime("%B %d, %Y") %></span>
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Insurance Contracts Section -->
      <div class="card mt-4">
        <div class="card-header d-flex justify-content-between align-items-center" style="background-color: #002C88; color: white;">
          <h5 class="mb-0">Insurance Contracts</h5>
          <%= link_to "Add Insurance Contract", new_individual_insurance_contract_path(@individual), class: "btn btn-sm", style: "background-color: #F9CB25; color: #031249;" %>
        </div>
        <div class="card-body">
          <% if @individual.insurance_contracts.empty? %>
            <div class="text-center py-4">
              <p class="text-muted mb-3">No insurance contracts yet</p>
              <%= link_to "Create first contract", new_individual_insurance_contract_path(@individual), class: "btn btn-primary" %>
            </div>
          <% else %>
            <div class="table-responsive">
              <table class="table table-hover">
                <thead class="table-light">
                  <tr>
                    <th>ID</th>
                    <th>Agreement</th>
                    <th>Age</th>
                    <th>Amount Covered</th>
                    <th>Premium</th>
                    <th>Effectivity</th>
                    <th>Expiry</th>
                    <th class="text-end">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% @individual.insurance_contracts.each do |contract| %>
                    <tr>
                      <td><%= contract.id %></td>
                      <td>
                        <span class="badge <%= contract.agreement_type == 'Agreement::Rate' ? 'bg-primary' : 'bg-secondary' %>">
                          <%= contract.agreement_type&.split('::')&.last || 'N/A' %>
                        </span>
                      </td>
                      <td><%= contract.age %></td>
                      <td><%= number_to_currency(contract.amount_covered) %></td>
                      <td><%= number_to_currency(contract.premium) %></td>
                      <td><%= contract.effectivity&.strftime("%m/%d/%Y") %></td>
                      <td><%= contract.expiry&.strftime("%m/%d/%Y") %></td>
                      <td class="text-end">
                        <%= link_to "View", [@individual, contract], class: "btn btn-sm btn-outline-primary" %>
                        <%= button_to "Delete", [@individual, contract], method: :delete,
                            data: { confirm: "Are you sure?" },
                            class: "btn btn-sm btn-outline-danger" %>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% end %>
        </div>
      </div>

      <div class="mt-4 d-flex gap-2">
        <%= link_to "Edit this individual", edit_individual_path(@individual), class: "btn btn-primary" %>
        <%= link_to "Back to individuals", individuals_path, class: "btn btn-secondary" %>
        <%= button_to "Delete this individual", @individual, method: :delete,
            data: { confirm: "Are you sure you want to delete this individual?" },
            class: "btn btn-tertiary" %>
      </div>
    </div>
  </div>
</div>